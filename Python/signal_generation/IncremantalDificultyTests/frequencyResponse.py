# Seting upp libraries
import os
import sys

SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
sys.path.append(os.path.dirname(SCRIPT_DIR))

import matplotlib.pyplot as pyplot
import numpy as np

# Set upp variables
samplingFreq = 510.0  # [kHz]

fftSampleAmplitude = [
511, 181, 2629, 0, 181, 0, 511, 0, 511, 0, 5550, 255, 443, 181, 1101, 255, 362, 0, 404, 0, 2547, 404, 746, 181, 905, 0, 181, 255, 543, 0, 181, 0, 724, 255, 1214, 313, 923, 362, 0, 362, 0, 627, 627, 1007, 5899, 1055, 701, 181, 313, 313, 255, 362, 1214, 0, 746, 313, 746, 181, 0, 0, 0, 0, 255, 181, 1187, 478, 905, 181, 0, 0, 313, 0, 181, 313, 767, 0, 362, 362, 1115, 404, 362, 362, 181, 0, 0, 181, 362, 0, 0, 255, 362, 0, 0, 404, 627, 443, 724, 313, 767, 511, 1755, 1159, 600, 255, 181, 313, 600, 0, 362, 362, 511, 0, 255, 255, 181, 0, 255, 0, 181, 181, 0, 255, 0, 181, 313, 255, 255, 181, 0, 181, 0, 181, 181, 0, 511, 443, 0, 0, 181, 0, 0, 0, 0, 313, 181, 255, 362, 0, 0, 0, 181, 181, 0, 0, 313, 572, 181, 181, 0, 0, 0, 181, 313, 255, 0, 0, 0, 0, 0, 255, 0, 0, 0, 181, 0, 255, 181, 478, 313, 181, 0, 313, 0, 181, 0, 0, 0, 0, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 443, 0, 0, 0, 181, 0, 0, 0, 0, 0, 404, 0, 181, 0, 0, 0, 0, 0, 181, 0, 0, 0, 255, 0, 0, 0, 255, 0, 181, 0, 0, 0, 181, 0, 0, 0, 181, 0, 0, 0, 0, 0, 181, 0, 0, 0, 181, 0, 0, 0, 0, 0, 181, 0, 0, 0, 181, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 0, 181, 0, 0, 0, 181, 0, 0, 0, 0, 0, 181, 0, 0, 0, 181, 0, 0, 0, 0, 0, 181, 0, 0, 0, 181, 0, 0, 0, 181, 0, 255, 0, 0, 0, 255, 0, 0, 0, 181, 0, 0, 0, 0, 0, 181, 0, 404, 0, 0, 0, 0, 0, 181, 0, 0, 0, 443, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 0, 0, 0, 0, 181, 0, 
313, 0, 181, 313, 478, 181, 255, 0, 181, 0, 0, 0, 255, 0, 0, 0, 0, 0, 255, 313, 181, 0, 0, 0, 181, 181, 572, 313, 0, 0, 181, 181, 0, 0, 0, 362, 255, 181, 313, 0, 0, 0, 0, 181, 0, 
0, 443, 511, 0, 181, 181, 0, 181, 0, 181, 255, 255, 313, 181, 0, 255, 0, 181, 181, 0, 255, 0, 181, 255, 255, 0, 511, 362, 362, 0, 600, 313, 181, 255, 600, 1159, 1755, 511, 767, 313, 724, 443, 627, 404, 0, 0, 362, 255, 0, 0, 362, 181, 0, 0, 181, 362, 362, 404, 1115, 362, 362, 0, 767, 313, 181, 0, 313, 0, 0, 181, 905, 478, 1187, 181, 255, 0, 0, 0, 0, 181, 746, 313, 746, 0, 1214, 362, 255, 313, 313, 181, 701, 1055, 5899, 1007, 627, 627, 0, 362, 0, 362, 923, 313, 1214, 255, 724, 0, 181, 0, 543, 255, 181, 0, 905, 181, 746, 404, 2547, 0, 404, 0, 362, 255, 1101, 181, 443, 255, 5550, 0, 511, 0, 511, 0, 181, 0, 2629, 181,
]

fftPeaks = np.array(
    [
    [2629, 996, 0.42],
    [5550, 4980, 1.82],
    [2547, 9960, -1.81],
    [5899, 21914, 2.77],
    [1755, 49804, -2.96],
    [1755, 460195, 2.96],
    [5899, 488085, -2.77],
    [2547, 500039, 1.81],
    [5550, 505019, -1.82],
    ]
)


# Calculate frequencies of specific amplitudes
sampleLenght = len(fftSampleAmplitude)
frequency = []

for i in range(sampleLenght):
    frequency += [i * (samplingFreq / sampleLenght)]

# Take the peaks from the 2D array
xPeaks = fftPeaks[:, 1] / 1000
yPeaks = fftPeaks[:, 0]

# Plot the frequency response of fft in frequency domain
fig, ax = pyplot.subplots()
ax.bar(frequency, fftSampleAmplitude, color="blue", width=0.8)
ax.scatter(xPeaks, yPeaks, color="red", s=10, linewidths=0.8, marker="x")

ax.set_title("FFT response in Frequency domain")
ax.set_xlabel("Frequency [kHz]")
ax.set_ylabel("Amplitude")
pyplot.show()
