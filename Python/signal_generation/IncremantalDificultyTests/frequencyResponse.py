# Seting upp libraries
import os
import sys

SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
sys.path.append(os.path.dirname(SCRIPT_DIR))

import matplotlib.pyplot as pyplot
import numpy as np

# Set upp variables
samplingFreq = 510.0  # [kHz]

fftSampleAmplitude = [
443, 868, 3071, 868, 478, 627, 511, 255, 0, 849, 4370, 746, 1070, 313, 0, 789, 627, 443, 443, 181, 3023, 362, 1819, 255, 511, 443, 181, 255, 600, 0, 478, 404, 809, 443, 181, 443, 
849, 443, 404, 362, 868, 652, 404, 652, 2118, 1086, 4870, 2501, 572, 255, 443, 1039, 181, 543, 1023, 255, 886, 313, 478, 627, 0, 478, 0, 443, 652, 443, 0, 404, 809, 313, 313, 600, 443, 181, 255, 0, 543, 652, 362, 0, 511, 404, 957, 404, 255, 181, 0, 313, 0, 313, 362, 404, 404, 0, 313, 181, 313, 313, 362, 991, 1378, 572, 362, 652, 404, 255, 404, 181, 362, 313, 0, 0, 313, 181, 313, 255, 0, 0, 313, 255, 0, 362, 0, 0, 255, 362, 0, 181, 0, 362, 313, 181, 181, 313, 0, 0, 511, 362, 181, 362, 181, 313, 255, 0, 362, 313, 313, 181, 0, 404, 0, 362, 0, 181, 0, 0, 313, 181, 181, 181, 181, 181, 0, 255, 0, 0, 0, 181, 181, 181, 0, 181, 313, 181, 0, 181, 0, 0, 181, 0, 181, 0, 0, 255, 0, 181, 255, 0, 0, 0, 0, 181, 0, 313, 0, 
0, 0, 181, 0, 181, 0, 313, 255, 181, 0, 0, 0, 0, 0, 0, 0, 255, 0, 181, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 181, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 181, 0, 255, 0, 0, 0, 0, 0, 0, 0, 181, 255, 313, 0, 181, 0, 181, 0, 0, 0, 313, 0, 181, 0, 0, 0, 0, 255, 181, 0, 255, 0, 0, 181, 0, 181, 0, 0, 181, 0, 181, 313, 181, 0, 181, 181, 181, 0, 0, 0, 255, 0, 181, 181, 181, 181, 181, 313, 0, 0, 181, 0, 362, 0, 404, 0, 181, 313, 313, 362, 0, 255, 313, 181, 362, 181, 362, 511, 0, 0, 313, 181, 181, 313, 362, 0, 181, 0, 362, 255, 0, 0, 362, 0, 255, 313, 0, 0, 255, 313, 181, 313, 0, 0, 313, 362, 181, 
404, 255, 404, 652, 362, 572, 1378, 991, 362, 313, 313, 181, 313, 0, 404, 404, 362, 313, 0, 313, 0, 181, 255, 404, 957, 404, 511, 0, 362, 652, 543, 0, 255, 181, 443, 600, 313, 313, 809, 404, 0, 443, 652, 443, 0, 478, 0, 627, 478, 313, 886, 255, 1023, 543, 181, 1039, 443, 255, 572, 2501, 4870, 1086, 2118, 652, 404, 652, 868, 362, 404, 443, 849, 443, 181, 443, 809, 404, 478, 0, 600, 255, 181, 443, 511, 255, 1819, 362, 3023, 181, 443, 443, 627, 789, 0, 313, 1070, 746, 4370, 849, 0, 255, 511, 627, 478, 868, 3071, 868,
]

fftPeaks = np.array(
    [
    [996, 3071, -0.67],
    [4980, 4370, -1.46],
    [9960, 3023, -2.01],
    [10957, 1819, -2.79],
    [21914, 2118, 2.66],
    [22910, 4870, 1.06],
    [49804, 1378, -0.73],
    [460195, 1378, 0.73],
    [487089, 4870, -1.06],
    [488085, 2118, -2.66],
    [499042, 1819, 2.79],
    [500039, 3023, 2.01],
    [505019, 4370, 1.46],
    ]
)


# Calculate frequencies of specific amplitudes
sampleLenght = len(fftSampleAmplitude)
frequency = []

for i in range(sampleLenght):
    frequency += [i * (samplingFreq / sampleLenght)]

# Take the peaks from the 2D array
xPeaks = fftPeaks[:, 0] / 1000
yPeaks = fftPeaks[:, 1]

# Plot the frequency response of fft in frequency domain
fig, ax = pyplot.subplots()
ax.bar(frequency, fftSampleAmplitude, color="blue", width=0.8)
ax.scatter(xPeaks, yPeaks, color="red", s=10, linewidths=0.8, marker="x")

ax.set_title("FFT response in Frequency domain")
ax.set_xlabel("Frequency [kHz]")
ax.set_ylabel("Amplitude")
pyplot.show()
