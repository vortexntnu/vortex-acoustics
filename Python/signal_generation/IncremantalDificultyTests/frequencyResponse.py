# Seting upp libraries
import os
import sys

SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
sys.path.append(os.path.dirname(SCRIPT_DIR))

import matplotlib.pyplot as pyplot
import numpy as np

# Set upp variables
samplingFreq = 510.0  # [kHz]

fftSampleAmplitude = [
313, 181, 181, 313, 181, 543, 404, 362, 543, 255, 313, 362, 443, 255, 181, 313, 313, 181, 677, 829, 3253, 923, 2745, 600, 724, 181, 0, 478, 313, 255, 404, 0, 255, 362, 255, 181, 181, 600, 572, 255, 809, 991, 724, 572, 2839, 1241, 5835, 3376, 868, 362, 627, 627, 0, 313, 313, 313, 0, 0, 181, 652, 478, 313, 181, 362, 313, 0, 0, 0, 0, 0, 362, 543, 789, 478, 181, 313, 255, 181, 0, 0, 181, 362, 362, 0, 443, 0, 0, 478, 0, 313, 181, 255, 0, 181, 181, 0, 255, 181, 404, 600, 1659, 1007, 767, 0, 0, 181, 0, 0, 0, 0, 255, 181, 652, 572, 627, 511, 181, 255, 0, 181, 0, 0, 255, 0, 181, 362, 443, 255, 181, 0, 181, 0, 0, 0, 181, 255, 511, 767, 849, 572, 0, 701, 511, 362, 313, 0, 0, 0, 0, 181, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 362, 255, 181, 255, 313, 181, 0, 181, 0, 0, 0, 0, 0, 0, 181, 255, 0, 362, 0, 362, 0, 0, 0, 0, 0, 0, 0, 255, 313, 181, 478, 0, 313, 0, 0, 0, 0, 0, 0, 0, 255, 0, 0, 0, 313, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 181, 313, 0, 0, 0, 0, 0, 0, 0, 181, 0, 255, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 181, 0, 0, 
0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 255, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 255, 0, 181, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 181, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 181, 0, 255, 0, 181, 0, 0, 0, 0, 0, 0, 0, 313, 181, 0, 0, 181, 0, 0, 0, 0, 0, 0, 0, 313, 0, 0, 0, 255, 0, 0, 0, 0, 0, 0, 0, 313, 0, 478, 181, 313, 255, 0, 0, 0, 0, 0, 0, 0, 
362, 0, 362, 0, 255, 181, 0, 0, 0, 0, 0, 0, 181, 0, 181, 313, 255, 181, 255, 362, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 181, 0, 0, 181, 0, 0, 0, 0, 313, 362, 511, 701, 0, 572, 849, 767, 511, 255, 181, 0, 0, 0, 181, 0, 181, 255, 443, 362, 181, 0, 255, 0, 0, 181, 0, 255, 181, 511, 627, 572, 652, 181, 255, 0, 0, 0, 0, 181, 0, 0, 767, 1007, 1659, 600, 404, 181, 255, 0, 181, 181, 0, 255, 181, 313, 0, 478, 0, 0, 443, 0, 362, 362, 181, 0, 0, 181, 255, 313, 181, 478, 789, 543, 362, 0, 0, 0, 0, 0, 313, 362, 181, 313, 478, 652, 181, 0, 0, 313, 313, 
313, 0, 627, 627, 362, 868, 3376, 5835, 1241, 2839, 572, 724, 991, 809, 255, 572, 600, 181, 181, 255, 362, 255, 0, 404, 255, 313, 478, 0, 181, 724, 600, 2745, 923, 3253, 829, 677, 181, 313, 313, 181, 255, 443, 362, 313, 255, 543, 362, 404, 543, 181, 313, 181, 181,
]

fftPeaks = np.array(
    [
    [9960, 3253, -22049,-2.11],
    [10957, 2745, 22664,2.17],
    [11953, 724, -26093,-2.50],
    [20419, 991, 458,0.04],
    [21914, 2839, 18568,1.78],
    [22910, 5835, 6308,0.60],
    [29384, 652, 14025,1.34],
    [35859, 789, -27266,-2.61],
    [49804, 1659, 16295,1.56],
    [55781, 652, 5852,0.56],
    [68730, 849, -21052,-2.02],
    [70224, 701, 27474,2.63],
    [439775, 701, -27474,-2.63],
    [441269, 849, 21052,2.02],
    [454218, 652, -5852,-0.56],
    [460195, 1659, -16295,-1.56],
    [474140, 789, 27266,2.61],
    [480615, 652, -14025,-1.34],
    [487089, 5835, -6308,-0.60],
    [488085, 2839, -18568,-1.78],
    [489580, 991, -458,-0.04],
    [498046, 724, 26093,2.50],
    [499042, 2745, -22664,-2.17],
    [500039, 3253, 22049,2.11],
    ]
)


# Calculate frequencies of specific amplitudes
sampleLenght = len(fftSampleAmplitude)
frequency = []

for i in range(sampleLenght):
    frequency += [i * (samplingFreq / sampleLenght)]

# Take the peaks from the 2D array
xPeaks = fftPeaks[:, 0] / 1000
yPeaks = fftPeaks[:, 1]

# Plot the frequency response of fft in frequency domain
fig, ax = pyplot.subplots()
ax.bar(frequency, fftSampleAmplitude, color="blue", width=2)
ax.scatter(xPeaks, yPeaks, color="red", s=10, linewidths=0.5, marker="x")

ax.set_title("FFT response in Frequency domain")
ax.set_xlabel("Frequency [kHz]")
ax.set_ylabel("Amplitude")
pyplot.show()
